{% extends "base.html" %}

{% block title %}Payments - Engineering College Management System{% endblock %}

{% block extra_css %}
<style>
    .payment-card {
        transition: transform 0.3s ease;
    }
    
    .payment-card:hover {
        transform: translateY(-5px);
    }
    
    .payment-status-badge {
        position: absolute;
        top: 10px;
        right: 10px;
    }
    
    .payment-method-icon {
        font-size: 1.5rem;
        margin-right: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row mb-4">
        <div class="col-md-6">
            <h1>Payments</h1>
            <p class="lead">Manage student payments and transactions</p>
        </div>
        <div class="col-md-6 text-md-end">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPaymentModal">
                <i class="fas fa-plus me-1"></i> Record New Payment
            </button>
        </div>
    </div>

    <!-- Search and Filter -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="searchPayment" class="form-label">Search</label>
                    <input type="text" class="form-control" id="searchPayment" placeholder="Receipt number, student name...">
                </div>
                <div class="col-md-3">
                    <label for="paymentStatus" class="form-label">Payment Status</label>
                    <select class="form-select" id="paymentStatus">
                        <option value="" selected>All</option>
                        <option value="paid">Paid</option>
                        <option value="pending">Pending</option>
                        <option value="overdue">Overdue</option>
                        <option value="refunded">Refunded</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="paymentDate" class="form-label">Date Range</label>
                    <select class="form-select" id="paymentDate">
                        <option value="all" selected>All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button class="btn btn-primary w-100">
                        <i class="fas fa-search me-1"></i> Search
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h5 class="card-title">Total Collected</h5>
                    <h2 class="mb-0">₹15,75,000</h2>
                    <small>This Academic Year</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h5 class="card-title">Paid</h5>
                    <h2 class="mb-0">₹12,60,000</h2>
                    <small>80% of Total</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-dark">
                <div class="card-body">
                    <h5 class="card-title">Pending</h5>
                    <h2 class="mb-0">₹2,36,250</h2>
                    <small>15% of Total</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-danger text-white">
                <div class="card-body">
                    <h5 class="card-title">Overdue</h5>
                    <h2 class="mb-0">₹78,750</h2>
                    <small>5% of Total</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Payments Table -->
    <div class="card">
        <div class="card-header bg-white">
            <h5 class="mb-0">Recent Payments</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Receipt #</th>
                            <th>Student</th>
                            <th>Payment Date</th>
                            <th>Amount</th>
                            <th>Payment Method</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>REC-2025-001</td>
                            <td>Sahana Patel (CSE2023001)</td>
                            <td>Nov 1, 2025</td>
                            <td>₹45,000</td>
                            <td>Bank Transfer</td>
                            <td><span class="badge bg-success">Paid</span></td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary" title="View"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-outline-secondary" title="Print Receipt"><i class="fas fa-print"></i></button>
                                    <button class="btn btn-outline-info" title="Email Receipt"><i class="fas fa-envelope"></i></button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>REC-2025-002</td>
                            <td>Rahul Kumar (ECE2022042)</td>
                            <td>Oct 28, 2025</td>
                            <td>₹45,000</td>
                            <td>Credit Card</td>
                            <td><span class="badge bg-success">Paid</span></td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary" title="View"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-outline-secondary" title="Print Receipt"><i class="fas fa-print"></i></button>
                                    <button class="btn btn-outline-info" title="Email Receipt"><i class="fas fa-envelope"></i></button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>REC-2025-003</td>
                            <td>Priya Singh (IT2023015)</td>
                            <td>Oct 25, 2025</td>
                            <td>₹22,500</td>
                            <td>UPI</td>
                            <td><span class="badge bg-warning text-dark">Partially Paid</span></td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary" title="View"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-outline-secondary" title="Print Receipt"><i class="fas fa-print"></i></button>
                                    <button class="btn btn-outline-info" title="Email Receipt"><i class="fas fa-envelope"></i></button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>REC-2025-004</td>
                            <td>Arjun Reddy (ME2021007)</td>
                            <td>Oct 20, 2025</td>
                            <td>₹0</td>
                            <td>-</td>
                            <td><span class="badge bg-danger">Overdue</span></td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary" title="View"><i class="fas fa-eye"></i></button>
                                    <button class="btn btn-outline-warning" title="Send Reminder"><i class="fas fa-bell"></i></button>
                                    <button class="btn btn-outline-success" title="Record Payment"><i class="fas fa-money-bill-wave"></i></button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-footer bg-white">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0">Showing 4 of 120 payments</p>
                </div>
                <div class="col-md-6">
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-end mb-0">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Pay Fee Modal -->
<div class="modal fade" id="makePaymentModal" tabindex="-1" aria-labelledby="makePaymentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="makePaymentModalLabel">Make Payment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="paymentForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="paymentStudentId" class="form-label">Student ID</label>
                            <input type="text" class="form-control" id="paymentStudentId" readonly>
                            <div class="invalid-feedback" id="studentIdFeedback">Please select a student.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="paymentStudentName" class="form-label">Student Name</label>
                            <input type="text" class="form-control" id="paymentStudentName" readonly>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="paymentFeeType" class="form-label">Fee Type</label>
                            <input type="text" class="form-control" id="paymentFeeType" readonly>
                            <div class="invalid-feedback" id="feeTypeFeedback">Please select a fee type.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="paymentAmount" class="form-label">Amount (₹)</label>
                            <input type="number" class="form-control" id="paymentAmount" readonly>
                            <div class="invalid-feedback" id="amountFeedback">Please enter a valid amount.</div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="paymentMethod" class="form-label">Payment Method</label>
                            <select class="form-select" id="paymentMethod" required>
                                <option value="" selected disabled>Select Payment Method</option>
                                <option value="cash">Cash</option>
                                <option value="cheque">Cheque</option>
                                <option value="bank_transfer">Bank Transfer</option>
                                <option value="credit_card">Credit Card</option>
                                <option value="debit_card">Debit Card</option>
                                <option value="upi">UPI</option>
                                <option value="other">Other</option>
                            </select>
                            <div class="invalid-feedback" id="paymentMethodFeedback">Please select a payment method.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="paymentDate" class="form-label">Payment Date</label>
                            <input type="date" class="form-control" id="paymentDate" value="2025-11-06" required>
                        </div>
                    </div>
                    
                    <!-- Card Details (initially hidden) -->
                    <div id="cardDetailsContainer" style="display: none;">
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Card Details</h6>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="cardNumber" class="form-label">Card Number</label>
                                        <input type="text" class="form-control" id="cardNumber" placeholder="XXXX XXXX XXXX XXXX">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="cardName" class="form-label">Name on Card</label>
                                        <input type="text" class="form-control" id="cardName" placeholder="Enter name as on card">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <label for="expiryMonth" class="form-label">Expiry Month</label>
                                        <select class="form-select" id="expiryMonth">
                                            <option value="" selected disabled>Month</option>
                                            <option value="01">01</option>
                                            <option value="02">02</option>
                                            <option value="03">03</option>
                                            <option value="04">04</option>
                                            <option value="05">05</option>
                                            <option value="06">06</option>
                                            <option value="07">07</option>
                                            <option value="08">08</option>
                                            <option value="09">09</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="expiryYear" class="form-label">Expiry Year</label>
                                        <select class="form-select" id="expiryYear">
                                            <option value="" selected disabled>Year</option>
                                            <option value="2025">2025</option>
                                            <option value="2026">2026</option>
                                            <option value="2027">2027</option>
                                            <option value="2028">2028</option>
                                            <option value="2029">2029</option>
                                            <option value="2030">2030</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="cvv" class="form-label">CVV</label>
                                        <input type="password" class="form-control" id="cvv" placeholder="XXX">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- UPI Details (initially hidden) -->
                    <div id="upiDetailsContainer" style="display: none;">
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">UPI Details</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="upiId" class="form-label">UPI ID</label>
                                        <input type="text" class="form-control" id="upiId" placeholder="username@upi">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="upiApp" class="form-label">UPI App</label>
                                        <select class="form-select" id="upiApp">
                                            <option value="" selected disabled>Select UPI App</option>
                                            <option value="gpay">Google Pay</option>
                                            <option value="phonepe">PhonePe</option>
                                            <option value="paytm">Paytm</option>
                                            <option value="bhim">BHIM</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bank Transfer Details (initially hidden) -->
                    <div id="bankDetailsContainer" style="display: none;">
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Bank Transfer Details</h6>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="bankName" class="form-label">Bank Name</label>
                                        <input type="text" class="form-control" id="bankName" placeholder="Enter bank name">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="accountNumber" class="form-label">Account Number</label>
                                        <input type="text" class="form-control" id="accountNumber" placeholder="Enter account number">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="ifscCode" class="form-label">IFSC Code</label>
                                        <input type="text" class="form-control" id="ifscCode" placeholder="Enter IFSC code">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="transactionId" class="form-label">Transaction ID</label>
                                        <input type="text" class="form-control" id="transactionId" placeholder="Enter transaction ID">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="remarks" class="form-label">Remarks</label>
                        <textarea class="form-control" id="remarks" rows="2" placeholder="Enter any additional information"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="payButton">Pay Now</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Payment Modal -->
<div class="modal fade" id="addPaymentModal" tabindex="-1" aria-labelledby="addPaymentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addPaymentModalLabel">Record New Payment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="studentId" class="form-label">Student</label>
                            <select class="form-select" id="studentId" required>
                                <option value="" selected disabled>Select Student</option>
                                <option value="1">Sahana Patel (CSE2023001)</option>
                                <option value="2">Rahul Kumar (ECE2022042)</option>
                                <option value="3">Priya Singh (IT2023015)</option>
                                <option value="4">Arjun Reddy (ME2021007)</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="feeType" class="form-label">Fee Type</label>
                            <select class="form-select" id="feeType" required>
                                <option value="" selected disabled>Select Fee Type</option>
                                <option value="tuition">Tuition Fee</option>
                                <option value="hostel">Hostel Fee</option>
                                <option value="transport">Transport Fee</option>
                                <option value="exam">Examination Fee</option>
                                <option value="library">Library Fee</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="amount" class="form-label">Amount (₹)</label>
                            <input type="number" class="form-control" id="amount" placeholder="Enter amount" required>
                        </div>
                        <div class="col-md-6">
                            <label for="paymentDate" class="form-label">Payment Date</label>
                            <input type="date" class="form-control" id="paymentDate" required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="paymentMethod" class="form-label">Payment Method</label>
                            <select class="form-select" id="paymentMethod" required>
                                <option value="" selected disabled>Select Payment Method</option>
                                <option value="cash">Cash</option>
                                <option value="cheque">Cheque</option>
                                <option value="bank_transfer">Bank Transfer</option>
                                <option value="credit_card">Credit Card</option>
                                <option value="debit_card">Debit Card</option>
                                <option value="upi">UPI</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="transactionId" class="form-label">Transaction ID</label>
                            <input type="text" class="form-control" id="transactionId" placeholder="Enter transaction ID">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="remarks" class="form-label">Remarks</label>
                        <textarea class="form-control" id="remarks" rows="3" placeholder="Enter any additional information"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Record Payment</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', path='/js/payments.js') }}"></script>
{% endblock %}
